# Failure Modes and Mitigations

**Date**: 2026-02-07
**Author**: GPT-5.3-Codex
**Status**: draft

Your architecture is a local-first, dual-interface system: Click CLI + FastAPI API + Next.js UI, with state split across filesystem/TOML (`~/.skillmeat`, project `.claude`) and SQLite (`cache.db`, `analytics.db`), plus GitHub as a critical upstream dependency. The highest-risk failures are around dependency outages, mixed-store consistency, SQLite contention, request-path heavy work, and default-open auth posture.

- **Failure mode:** GitHub dependency/rate-limit outage. **Trigger:** GitHub API degradation, missing token, scan/import bursts. **Symptoms:** source create/rescan and artifact file endpoints return `429/5xx`, scans stall, metadata goes stale. **Detection:** `skillmeat_github_requests_total`, `skillmeat_marketplace_scan_errors_total`, scan-duration histograms, `Retry-After` responses. **Mitigation:** enforce authenticated GitHub tokens, add stale-cache fallback + circuit breaker, move scan/import to background jobs with retry policy.
- **Failure mode:** Cross-store consistency drift (filesystem + TOML + SQLite not one transaction). **Trigger:** crash/interruption during deploy/sync/update, concurrent writes. **Symptoms:** artifact files copied but deployment/cache metadata missing or stale; false drift/conflict signals. **Detection:** reconciliation checks between `.claude` files, deployment tracker, and cache DB; drift anomaly spikes. **Mitigation:** make deployment tracker writes atomic, add operation journal/outbox + startup repair, keep writes idempotent.
- **Failure mode:** SQLite lock contention and scaling ceiling. **Trigger:** concurrent API operations (scan/refresh/sync) on one SQLite file. **Symptoms:** `database is locked`, retry delays, p95/p99 latency spikes, intermittent 500s. **Detection:** lock/retry logs, elevated API error/latency metrics. **Mitigation:** reduce write concurrency, shorten transactions/batch writes, consider Postgres for sustained multi-user/high-concurrency use.
- **Failure mode:** Long-running work on request path (availability/latency regression). **Trigger:** synchronous scan/clone/network work during API requests. **Symptoms:** slow/timeout requests, worker starvation under burst load. **Detection:** endpoint latency distribution, scan duration trends, worker saturation. **Mitigation:** queue heavy operations (scan/import/deep-index) off-request, return job IDs, enforce concurrency limits/backpressure.
- **Failure mode:** Security exposure from permissive defaults. **Trigger:** API exposed outside localhost with auth flags left off. **Symptoms:** unauthorized artifact/project mutations or reads. **Detection:** unexpected IPs/actions in access logs, config/deploy mutations without auth enforcement. **Mitigation:** secure-by-default startup checks, require API key/JWT for mutating routes, bind privately + enforce reverse-proxy auth.

**Confirmed vs inferred:** Confirmed from code in `/Users/miethe/dev/homelab/development/skillmeat/skillmeat/api/server.py`, `/Users/miethe/dev/homelab/development/skillmeat/skillmeat/api/config.py`, `/Users/miethe/dev/homelab/development/skillmeat/skillmeat/cache/models.py`, `/Users/miethe/dev/homelab/development/skillmeat/skillmeat/storage/deployment.py`, `/Users/miethe/dev/homelab/development/skillmeat/skillmeat/api/routers/marketplace_sources.py`. Inferred (not fully confirmed in repo): your production topology/HA setup and backup/restore operations outside app code.