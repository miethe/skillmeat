$schema: "http://json-schema.org/draft-07/schema#"
title: "Observation Log Artifact Schema"
type: object
description: "JSON Schema for observation log artifacts (YAML frontmatter validation)"

required:
  - type
  - month
  - year
  - period

properties:
  type:
    type: string
    enum: ["observations"]
    description: "Artifact type identifier"

  month:
    type: string
    minLength: 1
    maxLength: 2
    pattern: "^(0[1-9]|1[0-2]|[1-9])$"
    description: "Month number (1-12) as string"

  year:
    type: string
    minLength: 4
    maxLength: 4
    pattern: "^[0-9]{4}$"
    description: "Year in YYYY format (e.g., '2025')"

  period:
    type: string
    minLength: 21
    maxLength: 21
    pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2} to [0-9]{4}-[0-9]{2}-[0-9]{2}$"
    description: "Date range in format 'YYYY-MM-DD to YYYY-MM-DD'"

  observation_counts:
    type: object
    additionalProperties:
      type: integer
      minimum: 0
    default: {}
    description: "Count of observations by category"

  observations_by_category:
    type: object
    additionalProperties:
      type: array
      maxItems: 1000
      items:
        type: string
        pattern: "^OBS-[0-9]+$"
    default: {}
    description: "Observation IDs organized by category for efficient querying"

  observations_by_impact:
    type: object
    properties:
      high:
        type: array
        maxItems: 1000
        items:
          type: string
          pattern: "^OBS-[0-9]+$"
        default: []
      medium:
        type: array
        maxItems: 1000
        items:
          type: string
          pattern: "^OBS-[0-9]+$"
        default: []
      low:
        type: array
        maxItems: 1000
        items:
          type: string
          pattern: "^OBS-[0-9]+$"
        default: []
    default: {}
    description: "Observation IDs organized by impact level"

  observations:
    type: object
    additionalProperties:
      type: object
      required: ["id", "date", "category", "impact"]
      properties:
        id:
          type: string
          minLength: 2
          maxLength: 16
          pattern: "^OBS-[0-9]+$"
          description: "Observation identifier (e.g., 'OBS-1')"

        date:
          type: string
          format: "date-time"
          description: "Date and time of observation in ISO 8601 format"

        category:
          type: string
          enum: ["pattern-discoveries", "performance-insights", "architectural-learnings", "tools-techniques", "process-improvements", "other"]
          description: "Category of observation"

        impact:
          type: string
          enum: ["high", "medium", "low"]
          description: "Impact level of this observation"

        title:
          type: string
          minLength: 5
          maxLength: 256
          description: "Observation title"

        observation:
          type: string
          minLength: 10
          maxLength: 2048
          description: "Detailed observation"

        affects:
          type: array
          maxItems: 20
          items:
            type: string
            minLength: 3
            maxLength: 256
          default: []
          description: "Components or systems affected"

        solution_applied:
          type: string
          maxLength: 512
          description: "Solution or approach used based on observation"

        related_work:
          type: array
          maxItems: 10
          items:
            type: string
            minLength: 5
            maxLength: 256
          default: []
          description: "Links to related commits, files, or issues"

        follow_up:
          type: boolean
          default: false
          description: "Whether this observation requires follow-up"

        follow_up_notes:
          type: string
          maxLength: 512
          description: "Notes on what follow-up is needed"

        tags:
          type: array
          maxItems: 10
          items:
            type: string
            minLength: 3
            maxLength: 32
            pattern: "^[a-z0-9]([a-z0-9-]*[a-z0-9])?$"
          default: []
          description: "Tags for cross-category discovery (e.g., ['performance', 'react', 'state-management'])"

    default: {}
    description: "Detailed observation information indexed by observation ID"

  high_impact_count:
    type: integer
    minimum: 0
    default: 0
    description: "Number of high-impact observations"

  total_observations:
    type: integer
    minimum: 0
    description: "Total number of observations in period"

  actionable_observations:
    type: array
    maxItems: 100
    items:
      type: string
      pattern: "^OBS-[0-9]+$"
    default: []
    description: "Observation IDs that require follow-up action"

  updated:
    type: string
    format: "date-time"
    description: "Last update timestamp in ISO 8601 format"

  notes:
    type: string
    maxLength: 2048
    description: "General notes about observations in this period"

additionalProperties: false
