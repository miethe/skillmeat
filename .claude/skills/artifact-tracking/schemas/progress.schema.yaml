$schema: "http://json-schema.org/draft-07/schema#"
title: "Progress Tracking Artifact Schema"
type: object
description: "JSON Schema for progress tracking artifacts (YAML frontmatter validation)"
allOf:
  - $ref: "./envelope.schema.yaml"

required:
  - type
  - prd

properties:
  schema_version:
    type: integer
    minimum: 1
    description: "Optional CCDash schema version (v2 recommended)"

  doc_type:
    type: string
    enum: ["progress"]
    description: "Optional CCDash document type alias for compatibility"

  feature_slug:
    type: string
    minLength: 3
    maxLength: 64
    pattern: "^[a-z0-9]([a-z0-9-]*[a-z0-9])?$"
    description: "Optional feature slug alias for `prd`"

  prd_ref:
    oneOf:
      - type: "null"
      - type: string
        minLength: 3
        maxLength: 256
    default: null
    description: "Optional reference to PRD document path"

  plan_ref:
    oneOf:
      - type: "null"
      - type: string
        minLength: 3
        maxLength: 256
    default: null
    description: "Optional reference to parent implementation plan"

  commit_refs:
    type: array
    items:
      type: string
      minLength: 7
      maxLength: 64
    default: []
    description: "Optional commit references tied to this phase"

  pr_refs:
    type: array
    items:
      type: string
      minLength: 3
      maxLength: 64
    default: []
    description: "Optional pull request references tied to this phase"

  type:
    type: string
    enum: ["progress"]
    description: "Artifact type identifier"

  prd:
    type: string
    minLength: 3
    maxLength: 64
    description: "PRD identifier in kebab-case (e.g., 'advanced-editing-v2')"

  phase:
    oneOf:
      - type: integer
        minimum: 0
        maximum: 99
      - type: string
        minLength: 1
        maxLength: 16
    description: "Phase number (1, 2, 3, etc.)"

  title:
    type: string
    minLength: 5
    maxLength: 256
    description: "Phase title describing the work (e.g., 'Prompt Creation Modal Enhancements')"

  status:
    type: string
    description: "Current phase status"

  started:
    oneOf:
      - type: "null"
      - type: string
    description: "Phase start date in YYYY-MM-DD format"

  completed:
    oneOf:
      - type: "null"
      - type: string
      - type: array
      - type: object
    default: null
    description: "Phase completion date in YYYY-MM-DD format (null if not complete)"

  overall_progress:
    type: number
    minimum: 0
    maximum: 100
    description: "Overall progress percentage (0-100)"

  completion_estimate:
    type: string
    default: "on-track"
    description: "Estimated completion status based on current progress"

  total_tasks:
    type: integer
    minimum: 0
    description: "Total number of tasks in phase"

  completed_tasks:
    type: integer
    minimum: 0
    description: "Number of completed tasks"

  in_progress_tasks:
    type: integer
    minimum: 0
    description: "Number of in-progress tasks"

  blocked_tasks:
    type: integer
    minimum: 0
    description: "Number of blocked tasks"

  owners:
    type: array
    minItems: 1
    maxItems: 10
    items:
      type: string
      minLength: 3
      maxLength: 64
    default: []
    description: "Primary agents responsible for phase (kebab-case identifiers)"

  contributors:
    type: array
    maxItems: 20
    items:
      type: string
      minLength: 3
      maxLength: 64
    default: []
    description: "Secondary agents contributing to phase"

  # === ORCHESTRATION QUICK REFERENCE (REQUIRED) ===
  tasks:
    oneOf:
      - type: array
        maxItems: 500
        items:
          type: object
          properties:
            id:
              type: string
            description:
              type: string
            status:
              type: string
            assigned_to:
              oneOf:
                - type: array
                  items:
                    type: string
                - type: string
            dependencies:
              oneOf:
                - type: array
                  items: {}
                - type: object
            estimated_effort:
              type: string
            priority:
              type: string
      - type: object

    description: "All tasks with required assigned_to and dependencies fields for orchestration"

  parallelization:
    type: object
    properties:
      batch_1:
        oneOf:
          - type: array
            items: {}
          - type: object
        description: "Tasks in first batch (can run in parallel)"

      batch_2:
        oneOf:
          - type: array
            items: {}
          - type: object
        description: "Tasks in second batch"

      batch_3:
        oneOf:
          - type: array
            items: {}
          - type: object
        description: "Tasks in third batch"

      batch_4:
        oneOf:
          - type: array
            items: {}
          - type: object
        description: "Tasks in fourth batch"

      critical_path:
        oneOf:
          - type: array
            items: {}
          - type: object
        description: "Longest dependency chain (critical path)"

      estimated_total_time:
        type: string
        description: "Total time if batches run optimally (e.g., '5h')"

    description: "Parallelization strategy computed from dependencies"

  blockers:
    type: array
    maxItems: 50
    items:
      oneOf:
        - type: object
        - type: string

    default: []
    description: "Array of blocking issues preventing progress"

  success_criteria:
    type: array
    maxItems: 50
    items:
      oneOf:
        - type: object
        - type: string

    default: []
    description: "Measurable success criteria for phase completion"

  notes:
    oneOf:
      - type: string
        maxLength: 2048
      - type: array
        items:
          type: string
        maxItems: 200
    description: "Additional context or notes for future agents"

additionalProperties: false
additionalProperties: true
